<script>
    document.addEventListener('DOMContentLoaded', function() {
        // 0. Register GSAP Plugins
        gsap.registerPlugin(ScrollTrigger, ScrollToPlugin);

        // Ensure tour progress is hidden initially
        document.getElementById('tour-progress').classList.add('hidden');

        // Welcome Overlay & Tour System
        const welcomeOverlay = document.getElementById('welcome-overlay');
        const welcomeCard = document.getElementById('welcome-card');
        const startTourBtn = document.getElementById('start-tour-btn');
        const exploreBtn = document.getElementById('explore-btn');
        const tourProgress = document.getElementById('tour-progress');
        const skipTourBtn = document.getElementById('skip-tour-btn');
        const tourPauseResumeBtn = document.getElementById('tour-pause-resume-btn');
        const tourTimeEl = document.getElementById('tour-time');
        const audioPlayer = document.getElementById('universal-audio-player');
        const tourAudioSrc = 'https://storage.googleapis.com/agent-datalake-dev-public/trixel-tech-tour-audio.wav';

        let masterTourTimeline;

        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60).toString().padStart(2, '0');
            return `${minutes}:${secs}`;
        }

        function initializeTourTimeline() {
            masterTourTimeline = gsap.timeline({
                paused: true,
                onComplete: () => endTour()
            });

            addHeroAnimations(masterTourTimeline);
            addServicesAnimations(masterTourTimeline);
            addProcessAnimations(masterTourTimeline);
            addNicheAnimations(masterTourTimeline);
            addContactAnimations(masterTourTimeline);
        }

        function addHeroAnimations(timeline) {
            timeline.fromTo('nav a:first-child', { x: -100, opacity: 0 }, { x: 0, opacity: 1, duration: 2, ease: 'power2.out' }, 0);
            timeline.fromTo('nav a:not(:first-child)', { y: -30, opacity: 0 }, { y: 0, opacity: 1, duration: 0.5, stagger: 0.15, ease: 'power2.out' }, 2);
            timeline.call(() => {
                const headline = document.querySelector('h1.hero-headline');
                if (!headline) return;
                const text = headline.textContent;
                headline.textContent = '';
                headline.style.opacity = 1;
                let charIndex = 0;
                window.typeInterval = setInterval(() => {
                    if (charIndex < text.length) {
                        headline.textContent += text.charAt(charIndex);
                        charIndex++;
                    } else {
                        clearInterval(window.typeInterval);
                    }
                }, 100);
            }, null, 6);
            timeline.fromTo('.hero-subheadline', { y: 20, opacity: 0 }, { y: 0, opacity: 1, duration: 2, ease: 'power2.out' }, 11);
            timeline.to('#home .card', { y: -20, boxShadow: '0 0 30px rgba(59, 130, 246, 0.8)', duration: 0.8, stagger: 0.4, ease: 'power2.out', yoyo: true, repeat: 1 }, 13);
            timeline.to('a.btn-primary', { boxShadow: '0 0 40px rgba(59, 130, 246, 1)', scale: 1.08, duration: 0.5, yoyo: true, repeat: 3, ease: 'power2.inOut' }, 17);
            timeline.to(window, { duration: 3, scrollTo: { y: '#services', offsetY: 70 }, ease: 'power2.inOut' }, 19);
        }

        function highlightCard(selector) {
            document.querySelectorAll('#services .card').forEach(card => {
                gsap.to(card, { borderColor: 'var(--border-color)', boxShadow: 'none', duration: 0.3 });
            });
            gsap.to(selector, { borderColor: '#3B82F6', boxShadow: '0 0 30px rgba(59, 130, 246, 0.7)', duration: 0.5, ease: 'power2.out' });
        }

        function addServicesAnimations(timeline) {
            timeline.fromTo('#services h2, #services > div > p', { opacity: 0, y: 20 }, { opacity: 1, y: 0, duration: 1, ease: 'power2.out' }, 22);
            const cards = ['#services .card:nth-child(1)', '#services .card:nth-child(2)', '#services .card:nth-child(3)', '#services .card:nth-child(4)'];
            timeline.call(() => highlightCard(cards[0]), null, 22);
            timeline.fromTo(`${cards[0]} i, ${cards[0]} h3, ${cards[0]} p`, { opacity: 0 }, { opacity: 1, duration: 0.5, stagger: 0.1 }, 23);
            timeline.call(() => highlightCard(cards[1]), null, 26);
            timeline.fromTo(`${cards[1]} i, ${cards[1]} h3, ${cards[1]} p`, { opacity: 0 }, { opacity: 1, duration: 0.5, stagger: 0.1 }, 27);
            timeline.call(() => highlightCard(cards[2]), null, 32);
            timeline.fromTo(`${cards[2]} i, ${cards[2]} h3, ${cards[2]} p`, { opacity: 0 }, { opacity: 1, duration: 0.5, stagger: 0.1 }, 33);
            timeline.call(() => highlightCard(cards[3]), null, 40);
            timeline.fromTo(`${cards[3]} i, ${cards[3]} h3, ${cards[3]} p`, { opacity: 0 }, { opacity: 1, duration: 0.5, stagger: 0.1 }, 41);
            timeline.to('#ai-chat-toggle', { x: -5, duration: 0.1, yoyo: true, repeat: 9, ease: 'power1.inOut' }, 49);
            timeline.to('#services .card', { boxShadow: '0 0 25px rgba(59, 130, 246, 0.6)', duration: 0.3, stagger: 0.2, yoyo: true, repeat: 1 }, 52);
            timeline.call(() => gsap.to(window, { duration: 1, scrollTo: { y: cards[0], offsetY: 150 }, ease: 'power2.inOut' }), null, 66);
            timeline.fromTo(`${cards[0]} .interactive-btn`, { y: 20, opacity: 0 }, { y: 0, opacity: 1, duration: 0.3, stagger: 0.15, ease: 'back.out' }, 67);
            timeline.to(`${cards[0]} .interactive-btn`, { opacity: 0, duration: 0.5 }, 72);
            timeline.to('#audio-toggle', { boxShadow: '0 0 30px rgba(59, 130, 246, 0.9)', scale: 1.15, duration: 0.5, yoyo: true, repeat: 5, ease: 'power2.inOut' }, 78);
            timeline.to(window, { duration: 3, scrollTo: { y: '#process-timeline', offsetY: 70 }, ease: 'power2.inOut' }, 82);
        }

        function addProcessAnimations(timeline) {
            timeline.call(() => {
                const heading = document.querySelector('#process-timeline h3');
                if (!heading) return;
                const text = heading.textContent;
                heading.textContent = '';
                let charIndex = 0;
                window.typeInterval = setInterval(() => {
                    if (charIndex < text.length) {
                        heading.textContent += text.charAt(charIndex);
                        charIndex++;
                    } else {
                        clearInterval(window.typeInterval);
                    }
                }, 100);
            }, null, 86);
            const steps = ['#process-timeline .relative > div:nth-child(1)', '#process-timeline .relative > div:nth-child(2)', '#process-timeline .relative > div:nth-child(3)', '#process-timeline .relative > div:nth-child(4)'];
            timeline.to(`${steps[0]} .bg-blue-500`, { boxShadow: '0 0 20px rgba(59, 130, 246, 1)', scale: 1.2, duration: 0.5, ease: 'power2.out' }, 90);
            steps.slice(1).forEach((step, index) => {
                timeline.to(`${step} .bg-blue-500`, { boxShadow: '0 0 20px rgba(59, 130, 246, 1)', scale: 1.2, duration: 0.5, ease: 'power2.out' }, 92 + (index * 1.5));
            });
            timeline.to('#process-timeline .bg-blue-500', { opacity: 0.3, duration: 0.2, stagger: 0.3, yoyo: true, repeat: 1, ease: 'power1.inOut' }, 98);
            timeline.to(window, { duration: 1, scrollTo: { y: '#special-projects', offsetY: 70 }, ease: 'power2.inOut' }, 104);
        }

        function addNicheAnimations(timeline) {
            timeline.call(() => {
                const heading = document.querySelector('#special-projects h2');
                if (!heading) return;
                const text = heading.textContent;
                heading.textContent = '';
                let charIndex = 0;
                window.typeInterval = setInterval(() => {
                    if (charIndex < text.length) {
                        heading.textContent += text.charAt(charIndex);
                        charIndex++;
                    } else {
                        clearInterval(window.typeInterval);
                    }
                }, 50);
            }, null, 105);
            timeline.fromTo('#special-projects p', { y: 30, opacity: 0 }, { y: 0, opacity: 1, duration: 2, ease: 'power2.out' }, 107);
            timeline.to('#special-projects a.btn-secondary', { boxShadow: '0 0 40px rgba(59, 130, 246, 1)', borderColor: '#3B82F6', scale: 1.1, duration: 1, ease: 'power2.out' }, 114);
            timeline.to(window, { duration: 1, scrollTo: { y: '#contact', offsetY: 70 }, ease: 'power2.inOut' }, 115);
        }

        function addContactAnimations(timeline) {
            timeline.call(() => {
                const heading = document.querySelector('#contact h2');
                if (!heading) return;
                const text = heading.textContent;
                heading.textContent = '';
                let charIndex = 0;
                window.typeInterval = setInterval(() => {
                    if (charIndex < text.length) {
                        heading.textContent += text.charAt(charIndex);
                        charIndex++;
                    } else {
                        clearInterval(window.typeInterval);
                    }
                }, 100);
            }, null, 116);
            timeline.to(window, { duration: 6, scrollTo: { y: '#contact form', offsetY: 200 }, ease: 'power1.inOut' }, 120);
            timeline.to('#contact form, #contact .card', { boxShadow: '0 0 25px rgba(59, 130, 246, 0.5)', duration: 2, ease: 'power2.out' }, 122);
            timeline.to('#contact button[type="submit"]', { boxShadow: '0 0 35px rgba(59, 130, 246, 1)', scale: 1.08, duration: 0.5, yoyo: true, repeat: 7, ease: 'power2.inOut' }, 126);
            timeline.to(window, { duration: 2, scrollTo: { y: 'footer', offsetY: 0 }, ease: 'power2.inOut' }, 130);
            timeline.to('footer a:first-child', { scale: 1.15, duration: 0.8, yoyo: true, repeat: 1, ease: 'power2.inOut' }, 131);
        }

        audioPlayer.addEventListener('play', () => {
            if (masterTourTimeline) masterTourTimeline.play();
            const icon = tourPauseResumeBtn.querySelector('i');
            if (icon) {
                icon.setAttribute('data-lucide', 'pause');
                lucide.createIcons();
            }
        });

        audioPlayer.addEventListener('pause', () => {
            if (masterTourTimeline) masterTourTimeline.pause();
            const icon = tourPauseResumeBtn.querySelector('i');
            if (icon) {
                icon.setAttribute('data-lucide', 'play');
                lucide.createIcons();
            }
        });

        audioPlayer.addEventListener('timeupdate', () => {
            if (masterTourTimeline && Math.abs(masterTourTimeline.time() - audioPlayer.currentTime) > 0.2) {
                masterTourTimeline.time(audioPlayer.currentTime);
            }
            if (tourTimeEl && !isNaN(audioPlayer.duration)) {
                tourTimeEl.textContent = `${formatTime(audioPlayer.currentTime)} / ${formatTime(audioPlayer.duration)}`;
            }
        });

        audioPlayer.addEventListener('loadedmetadata', () => {
            if (tourTimeEl && !isNaN(audioPlayer.duration)) {
                tourTimeEl.textContent = `0:00 / ${formatTime(audioPlayer.duration)}`;
            }
        });

        function dismissOverlay() {
            gsap.to(welcomeOverlay, {
                opacity: 0,
                duration: 0.5,
                onComplete: () => welcomeOverlay.style.display = 'none'
            });
        }

        function startTour() {
             dismissOverlay();
            document.getElementById('tour-blocker').classList.remove('hidden');
            document.body.classList.add('no-scroll');
            tourProgress.classList.remove('hidden');
            gsap.fromTo(tourProgress, { y: -20, opacity: 0 }, { y: 0, opacity: 1, duration: 0.5 });

            if (!masterTourTimeline) {
                initializeTourTimeline();
            }

            audioPlayer.src = tourAudioSrc;
            audioPlayer.load();
            audioPlayer.play();

            masterTourTimeline.restart();
        }

        function endTour() {
            if (masterTourTimeline) {
                masterTourTimeline.pause();
                masterTourTimeline.time(0);
            }

            audioPlayer.pause();
            audioPlayer.currentTime = 0;

            if (window.typeInterval) {
                clearInterval(window.typeInterval);
            }

            document.getElementById('tour-blocker').classList.add('hidden');
            document.body.classList.remove('no-scroll');
            gsap.to(tourProgress, {
                y: -20,
                opacity: 0,
                duration: 0.3,
                onComplete: () => tourProgress.classList.add('hidden')
            });

            resetTourStyles();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function resetTourStyles() {
             document.querySelectorAll('#services .card').forEach(card => {
                gsap.to(card, {
                    borderColor: 'var(--border-color)',
                    boxShadow: 'none',
                    duration: 0.3
                });
            });
            gsap.set(['#contact form, #contact .card', '#special-projects a.btn-secondary', '#audio-toggle', 'a.btn-primary', '#process-timeline .bg-blue-500'], {
                clearProps: "boxShadow,scale,borderColor,opacity"
            });
        }

        startTourBtn.addEventListener('click', startTour);
        skipTourBtn.addEventListener('click', endTour);
        tourPauseResumeBtn.addEventListener('click', () => {
            if (audioPlayer.paused) {
                audioPlayer.play();
            } else {
                audioPlayer.pause();
            }
        });
        exploreBtn.addEventListener('click', dismissOverlay);

        gsap.to(welcomeOverlay, {
            opacity: 1,
            duration: 0.5,
            delay: 0.5,
            onStart: () => welcomeOverlay.classList.remove('opacity-0')
        });
        gsap.to(welcomeCard, {
            scale: 1,
            opacity: 1,
            duration: 0.5,
            ease: "power2.out",
            delay: 0.7,
            onStart: () => welcomeCard.classList.remove('scale-95', 'opacity-0')
        });

        lucide.createIcons();

        const aiChatWidget = document.getElementById('ai-chat-widget');
        const chatMessages = document.getElementById('chat-messages');
        const closeChatBtn = document.getElementById('close-chat-btn');
        const interactiveButtons = document.querySelectorAll('.interactive-btn');
        const aiChatToggle = document.getElementById('ai-chat-toggle');
        const aiOrb = document.getElementById('ai-orb');

        let isChatOpen = false;

        function showAIChat(message) {
            const initialMessage = message || "Hello! How can I help you today?";
            chatMessages.innerHTML = `<div class="text-sm text-text-secondary mb-2 p-3 rounded-lg bg-blue-900/30 self-start max-w-[85%]"><span>${initialMessage}</span></div>`;
            aiChatWidget.classList.remove('hidden');
            aiChatWidget.classList.add('flex');
            gsap.to(aiChatWidget, { y: 0, opacity: 1, duration: 0.4, ease: 'power3.out' });
            isChatOpen = true;
            hideAIOrb();
            document.getElementById('chat-input').focus();
        }

        function hideAIChat() {
            gsap.to(aiChatWidget, {
                y: 20,
                opacity: 0,
                duration: 0.3,
                ease: 'power3.in',
                onComplete: () => {
                    aiChatWidget.classList.add('hidden');
                    aiChatWidget.classList.remove('flex');
                    isChatOpen = false;
                }
            });
            hideAIOrb();
        }

        function toggleAIChat() {
            if (isChatOpen) {
                hideAIChat();
            } else {
                showAIChat();
            }
        }

        function showAIOrb(service, action) {
            aiOrb.dataset.service = service;
            aiOrb.dataset.action = action;
            aiOrb.classList.remove('hidden');
            gsap.fromTo(aiOrb, { scale: 0.5, opacity: 0 }, { scale: 1, opacity: 1, duration: 0.3, ease: 'back.out' });
        }

        function hideAIOrb() {
            gsap.to(aiOrb, { scale: 0.5, opacity: 0, duration: 0.2, ease: 'back.in', onComplete: () => aiOrb.classList.add('hidden') });
        }

        function appendMessage(content, sender = 'ai') {
            const messageEl = document.createElement('div');
            const isUser = sender === 'user';
            const alignment = isUser ? 'self-end' : 'self-start';
            const bgColor = isUser ? 'bg-gray-700' : 'bg-blue-900/30';
            messageEl.className = `text-sm text-text-primary mb-2 p-3 rounded-lg ${bgColor} ${alignment} max-w-[85%]`;
            messageEl.innerHTML = `<span>${content}</span>`;
            chatMessages.appendChild(messageEl);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function showTypingIndicator() {
            if (document.getElementById('typing-indicator-wrapper')) return;
            const indicatorWrapper = document.createElement('div');
            indicatorWrapper.id = 'typing-indicator-wrapper';
            indicatorWrapper.className = 'self-start mb-2';
            indicatorWrapper.innerHTML = `<div class="text-sm text-text-secondary p-3 rounded-lg bg-blue-900/30"><span>Trixel AI is typing...</span></div>`;
            chatMessages.appendChild(indicatorWrapper);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function hideTypingIndicator() {
            const indicator = document.getElementById('typing-indicator-wrapper');
            if (indicator) {
                indicator.remove();
            }
        }

        aiChatToggle.addEventListener('click', toggleAIChat);

        aiOrb.addEventListener('click', function() {
            const { service, action } = this.dataset;
            let message = "";
            if (action === 'ask') {
                message = `Of course! What specific questions do you have about our <strong>${service}</strong> service?`;
            } else if (action === 'explain') {
                message = `Certainly. Our <strong>${service}</strong> service is designed to provide maximum value.`;
            } else if (action === 'order') {
                message = `Excellent choice! To get started with <strong>${service}</strong>, please use our contact form.`;
            }
            if (message) {
                showAIChat(message);
            }
            hideAIOrb();
        });

        interactiveButtons.forEach(button => {
            button.addEventListener('click', function() {
                const action = this.textContent.toLowerCase();
                const card = this.closest('.card');
                const serviceTitle = card.querySelector('h3').textContent;
                showAIOrb(serviceTitle, action);
            });
        });

        closeChatBtn.addEventListener('click', hideAIChat);

        const chatInputForm = document.getElementById('chat-input-form');
        const chatInput = document.getElementById('chat-input');
        chatInputForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const userInput = chatInput.value.trim();
            if (!userInput) return;
            appendMessage(userInput, 'user');
            chatInput.value = '';
            showTypingIndicator();
            setTimeout(() => {
                hideTypingIndicator();
                const aiResponse = `<p class="mb-2">Trixel Technologies is a modern web development agency...</p><strong class="font-semibold">Key Features:</strong><ul class="list-disc list-inside mt-1 space-y-1"><li>Premium Design</li><li>Fast 5-Day Delivery</li><li>Lead-Focused Strategy</li><li>SEO Optimized</li></ul>`;
                appendMessage(aiResponse);
            }, 1500);
        });

        function enhanceFormValidation() {
            const forms = document.querySelectorAll('form[required]');
            forms.forEach(form => {
                form.setAttribute('novalidate', true);
                form.addEventListener('submit', function(event) {
                    if (!this.checkValidity()) {
                        event.preventDefault();
                        event.stopPropagation();
                        this.querySelectorAll('input[required], textarea[required], select[required]').forEach(input => {
                            if (!input.validity.valid) {
                                input.classList.add('border-red-500');
                            } else {
                                input.classList.remove('border-red-500');
                            }
                        });
                        alert('Please fill out all required fields correctly.');
                    }
                });
            });
        }
        enhanceFormValidation();

        const audioToggle = document.getElementById('audio-toggle');
        audioToggle.addEventListener('click', () => {
            const audioIcon = audioToggle.querySelector('i');
            const isMuted = audioIcon.getAttribute('data-lucide') === 'volume-x';
            audioIcon.setAttribute('data-lucide', isMuted ? 'volume-2' : 'volume-x');
            lucide.createIcons();
        });

        const themeToggle = document.getElementById('theme-toggle');
        themeToggle.addEventListener('click', () => {
            document.body.classList.toggle('light-theme');
            const isLight = document.body.classList.contains('light-theme');
            themeToggle.querySelector('[data-lucide="sun"]').classList.toggle('hidden', !isLight);
            themeToggle.querySelector('[data-lucide="moon"]').classList.toggle('hidden', isLight);
            localStorage.setItem('theme', isLight ? 'light' : 'dark');
        });

        if (localStorage.getItem('theme') === 'light') {
            document.body.classList.add('light-theme');
            themeToggle.querySelector('[data-lucide="sun"]').classList.remove('hidden');
            themeToggle.querySelector('[data-lucide="moon"]').classList.add('hidden');
        }

        const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
        const mobileMenu = document.getElementById('mobile-menu');
        const mobileMenuBackdrop = document.getElementById('mobile-menu-backdrop');

        const closeMobileMenu = () => {
            mobileMenu.classList.remove('active');
            mobileMenuBackdrop.classList.remove('active');
        };

        mobileMenuToggle.addEventListener('click', () => {
            mobileMenu.classList.add('active');
            mobileMenuBackdrop.classList.add('active');
        });

        document.querySelectorAll('#mobile-menu a').forEach(link => {
            link.addEventListener('click', closeMobileMenu);
        });

        mobileMenuBackdrop.addEventListener('click', closeMobileMenu);

        const backToTopButton = document.getElementById('back-to-top');
        window.addEventListener('scroll', () => {
            if (window.scrollY > 300) {
                backToTopButton.classList.add('visible');
            } else {
                backToTopButton.classList.remove('visible');
            }
        });
        
        backToTopButton.addEventListener('click', () => {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        const contactForm = document.getElementById('contact-form');
        const reviewForm = document.getElementById('review-form');
        const budgetRange = document.getElementById('budget-range');
        const budgetValue = document.getElementById('budget-value');

        if (budgetRange && budgetValue) {
            budgetRange.addEventListener('input', (e) => {
                budgetValue.textContent = `$${e.target.value}`;
            });
        }

        if (contactForm) {
            contactForm.addEventListener('submit', (e) => {
                e.preventDefault();
                alert('Thank you for your message! We will get back to you within 24 hours.');
                contactForm.reset();
                if (budgetValue) budgetValue.textContent = '$2500';
            });
        }

        const starRatingContainer = document.getElementById('star-rating-container');
        const ratingValueInput = document.getElementById('rating-value');
        const reviewsContainer = document.getElementById('reviews-container');
        let reviews = [];
        let currentRating = 0;

        function renderStars(rating = 0) {
            let starsHTML = '';
            for (let i = 1; i <= 5; i++) {
                starsHTML += `<svg class="${i <= rating ? 'selected' : ''}" fill="currentColor" viewBox="0 0 24 24"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"></path></svg>`;
            }
            return starsHTML;
        }

        function renderReviews() {
            if (!reviewsContainer) return;
            reviewsContainer.innerHTML = '';
            if (reviews.length === 0) {
                reviewsContainer.innerHTML = `<div class="md:col-span-2 text-center text-[var(--text-secondary)] p-8">No reviews yet. Be the first to share your experience!</div>`;
            } else {
                reviews.forEach(review => {
                    const reviewCard = document.createElement('div');
                    reviewCard.className = 'card';
                    reviewCard.innerHTML = `
                        <div class="star-rating !justify-start mb-2">${renderStars(review.rating)}</div>
                        <p class="text-[var(--text-secondary)] mb-4 flex-1 italic">"${review.text}"</p>
                        <p class="font-bold text-right text-[var(--text-primary)]">- ${review.name}</p>
                        ${review.company ? `<p class="text-sm text-right text-[var(--text-secondary)]">${review.company}</p>` : ''}
                    `;
                    reviewsContainer.appendChild(reviewCard);
                });
            }
        }

        if (starRatingContainer && ratingValueInput) {
            const maxStars = 5;
            for (let i = 1; i <= maxStars; i++) {
                const star = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
                star.setAttribute('viewBox', '0 0 24 24');
                star.setAttribute('fill', 'currentColor');
                star.dataset.value = i;
                star.innerHTML = `<path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"></path>`;
                starRatingContainer.appendChild(star);
            }
            const stars = starRatingContainer.querySelectorAll('svg');
            function updateStarsUI(rating, isHover = false) {
                stars.forEach(star => {
                    star.classList.remove('selected', 'hovered');
                    if (star.dataset.value <= rating) {
                        star.classList.add(isHover ? 'hovered' : 'selected');
                    }
                });
            }
            starRatingContainer.addEventListener('mouseover', e => {
                if (e.target.closest('svg')) {
                    updateStarsUI(e.target.closest('svg').dataset.value, true);
                }
            });
            starRatingContainer.addEventListener('mouseout', () => {
                updateStarsUI(currentRating);
            });
            starRatingContainer.addEventListener('click', e => {
                const star = e.target.closest('svg');
                if (star) {
                    currentRating = star.dataset.value;
                    ratingValueInput.value = currentRating;
                    updateStarsUI(currentRating);
                }
            });
            renderReviews();
        }

        if (reviewForm) {
            reviewForm.addEventListener('submit', (e) => {
                e.preventDefault();
                if (ratingValueInput.value === "0") {
                    alert("Please select a star rating before submitting.");
                    return;
                }
                const formData = new FormData(reviewForm);
                reviews.push({
                    rating: formData.get('rating'),
                    name: formData.get('name'),
                    company: formData.get('company'),
                    text: formData.get('review')
                });
                alert('Thank you for your review! It has been submitted successfully.');
                reviewForm.reset();
                ratingValueInput.value = "0";
                currentRating = 0;
                updateStarsUI(0);
                renderReviews();
            });
        }
        
        function initHeroAnimations() {
            const heroTl = gsap.timeline();
            heroTl.fromTo('h1.hero-headline', { y: 50, opacity: 0 }, { duration: 1, y: 0, opacity: 1, ease: "power2.out" })
                .fromTo('p.text-xl', { y: 30, opacity: 0 }, { duration: 0.8, y: 0, opacity: 1, ease: "power2.out" }, "-=0.5")
                .fromTo('p.text-lg', { y: 30, opacity: 0 }, { duration: 0.8, y: 0, opacity: 1, ease: "power2.out" }, "-=0.3")
                .fromTo('a.btn-primary', { y: 20, opacity: 0 }, { duration: 0.6, y: 0, opacity: 1, ease: "power2.out" }, "-=0.2")
                .fromTo('#home .card', { y: 40, opacity: 0 }, { duration: 0.8, y: 0, opacity: 1, stagger: 0.2, ease: "power2.out" }, "-=0.3");
        }

        function initScrollAnimations() {
            gsap.utils.toArray('section:not(#home) .card').forEach(card => {
                gsap.from(card, {
                    scrollTrigger: { trigger: card, start: "top 85%", toggleActions: "play none none none" },
                    y: 60,
                    opacity: 0,
                    duration: 0.8,
                    ease: "power2.out"
                });
            });
            gsap.utils.toArray('section h2').forEach(heading => {
                 gsap.from(heading, {
                    scrollTrigger: { trigger: heading, start: "top 85%", toggleActions: "play none none none" },
                    y: 40,
                    opacity: 0,
                    duration: 1,
                    ease: "power2.out"
                });
            });
            const processTimeline = document.getElementById('process-timeline');
            if (processTimeline) {
                const steps = gsap.utils.toArray("#process-timeline .relative > div");
                gsap.from(steps, {
                    scrollTrigger: { trigger: processTimeline, start: "top 70%", toggleActions: "play none none none" },
                    opacity: 0,
                    y: 50,
                    stagger: 0.3,
                    duration: 0.8,
                    ease: 'power2.out'
                });
            }
            document.querySelectorAll('.interactive-btn').forEach(btn => {
                btn.addEventListener('mouseenter', () => gsap.to(btn, { y: -2, duration: 0.2, ease: 'power2.out' }));
                btn.addEventListener('mouseleave', () => gsap.to(btn, { y: 0, duration: 0.2, ease: 'power2.out' }));
            });
        }

        initHeroAnimations();
        initScrollAnimations();
    });
  </script>
</body>
</html>